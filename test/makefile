# c++ compiler with flag to
# keep symbols.
CXX = clang++ -g
 
# c++11 compilance and dependency gen 
CXXFLAGS  = -std=c++11 -MMD -MP

# search paths for header files
INCLUDES = -I ../include/poker \
		   -isystem ../../../dep/UnitTest++/src \
		   -isystem ../../../dep/decimal_for_cpp/include

# add paths of libraries the
# targets depend on.
LIBRARIES = -L ../lib/$(target) -lpoker \
			-L ../../../dep/UnitTest++ -lUnitTest++ 

# gather all source files and define
# where the object files of each target go.
CPP_FILES = $(wildcard *.cpp)
OBJ_FILES = $(addprefix obj/$(target)/,$(notdir $(CPP_FILES:.cpp=.o)))
DEP_FILES = $(OBJ_FILES:.o=.d)

ifeq ($(target),debug)
	# all warnings and disable c++98 compilance
	# -v for more compilation output
	# disable some error messages from unittest++
	CXXFLAGS +=-O0 -Weverything -Wno-c++98-compat -v \
			   -Wno-missing-variable-declarations \
			   -Wno-global-constructors -Wno-exit-time-destructors \
			   -Wno-padded -Wno-missing-prototypes
else
    target = release
	CXXFLAGS +=-O3 -Wall -pedantic
endif

OUT_BIN = bin/$(target)/tests

# implict targets to build source files
obj/$(target)/%.o: %.cpp
	$(CXX) $(INCLUDES) $(CXXFLAGS) -c -o $@ $<

# link targets with their specific
# target options.
$(OUT_BIN): $(OBJ_FILES)
	$(CXX) $(INCLUDES) $(OBJ_FILES) $(LIBRARIES) -o $(OUT_BIN)

# runs the tests
run:
	./bin/$(target)/tests

# target cleans all files generated by 
# the buildprocess.
clean:
	rm -f $(OBJ_FILES)
	rm -f $(DEP_FILES)
	rm -f $(OUT_BIN)

all: $(OUT_BIN) run

-include $(DEP_FILES)

.PHONY: clean all run
